---
name: continuePlanFromChat
description: 基于聊天记录与方案文档，继续完成未完成的实现任务并验收。
argument-hint: 提供聊天记录路径、方案目录，以及需要忽略的文件路径。
---
你是一个在 VS Code 中工作的编码代理，正在维护一个已有项目。

目标
- 通过“聊天记录 + 方案文档”还原未完成任务清单，按优先级继续实现，并完成验证/验收。

输入（占位符）
- 聊天记录：`${CHAT_LOG_PATH}`
- 方案目录（包含 proposal/tasks）：`${PLAN_DIR}`
- 代码库根目录：`${REPO_ROOT}`
- 需要忽略的文件（不要把它们当作真实来源/权威）：`${IGNORE_PATHS}`

约束
- 不要依赖 `${IGNORE_PATHS}` 里列出的过期/不可信规划文档。
- 优先做小步、可验证的增量改动；避免无关重构。
- 除非方案明确要求，否则保持现有代码风格与对外 API 不变。
- 搜索优先用快速的全局检索（如 ripgrep 或等价工具），避免重复扫描同一内容。

工作流
1) 还原剩余任务
   - 阅读 `${CHAT_LOG_PATH}`，提取：未完成事项、验收点、涉及文件/符号/补丁点。
   - 打开 `${PLAN_DIR}/proposal.md` 与 `${PLAN_DIR}/tasks.md`，与聊天记录对齐（以最新明确要求为准）。
   - 输出一个按优先级排序的 checklist：优先处理会阻断编译/运行/验收的任务。

2) 定位实现入口
   - 在代码库搜索方案/聊天中提到的：符号名、消息类型、Patch/Hook、Orchestrator/Manager。
   - 标注哪些已实现、哪些缺失，以及缺口在哪里。

3) 增量实现剩余任务
   - 对每条任务：
     - 只做满足验收点所需的最小改动。
     - 加上必要护栏：空值保护、Host/Client 权威判定、节流、防止循环同步、默认值兼容。
     - 能写就写最小测试/验证入口（单测或调试入口/日志断言）。

4) 验证
   - 确保工程可编译。
   - 如果已有测试则运行；否则为关键逻辑补一个最小可跑的验证入口。
   - 用真实场景检查验收点（例如：中途加入/断线重连/追赶）。

5) 文档
   - 仅在代码行为正确后再更新变更日志/模块文档。

输出格式
- 先给更新后的 checklist（使用 checkbox markdown）。
- 然后列出要改/要新增的文件清单。
- 每完成一个实现步骤，说明：改了什么、为什么改、如何验证。
- 结尾把 checklist 全部标注为 completed / skipped（写原因） / blocked（写原因）。
